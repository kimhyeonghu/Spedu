{% extends 'admin_page.html' %}
{% block head %}
<title>New Course</title>
<link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/new_course.css') }}">

{% endblock %}
{% block body %}
<div class="menu">
  <div class="userBox">
    <svg xmlns="http://www.w3.org/2000/svg" width="105.262" height="105.262" viewBox="0 0 105.262 105.262">
      <path id="Icon_awesome-user-circle" data-name="Icon awesome-user-circle" d="M52.631.562a52.631,52.631,0,1,0,52.631,52.631A52.622,52.622,0,0,0,52.631.562Zm0,20.373A18.676,18.676,0,1,1,33.956,39.611,18.676,18.676,0,0,1,52.631,20.936Zm0,73A40.667,40.667,0,0,1,21.541,79.467a23.661,23.661,0,0,1,20.9-12.691,5.193,5.193,0,0,1,1.507.233,28.1,28.1,0,0,0,8.68,1.464,27.992,27.992,0,0,0,8.68-1.464,5.193,5.193,0,0,1,1.507-.233,23.661,23.661,0,0,1,20.9,12.691A40.667,40.667,0,0,1,52.631,93.94Z" transform="translate(0 -0.563)" fill="#fff"/>
    </svg>
    <br>
    <div class="">
      <svg id="crown "xmlns="http://www.w3.org/2000/svg" width="16.142" height="13.451" viewBox="0 0 16.142 13.451">
        <path id="crown" d="M2.018,11.416,0,4.69l4.778,2.69L8.071,2l3.293,5.381,4.778-2.69-2.018,6.726Zm0,1.345v2.69H14.124v-2.69Z" transform="translate(0 -2)" fill="#fff"/>
      </svg>
      <p id="menuAccountType class="align-middle"">Admin</p>
    </div>
    <p id="menuUsername">{{ current_user.get_username() }}</p>
  </div>
  <ul class="sideBar">
    <li class="option">
      <a href="/admin_page/">
        <svg xmlns="http://www.w3.org/2000/svg" width="38.263" height="36.509" viewBox="0 0 38.263 36.509">
          <path id="Path_292" data-name="Path 292" d="M37.91,27.614,19.9,11.512a.505.505,0,0,0-.1-.079,1.065,1.065,0,0,0-1.44-.024L.355,27.511A1.065,1.065,0,0,0,1.772,29.1l3.242-2.9V44.974A2.679,2.679,0,0,0,7.69,47.65h5.682a2.512,2.512,0,0,0,2.51-2.51V35.594a.386.386,0,0,1,.386-.386H22a.386.386,0,0,1,.386.386V45.14a2.512,2.512,0,0,0,2.51,2.51h5.682c1.5,0,2.676-1.472,2.676-3.353v-18L36.5,29.2a1.07,1.07,0,0,0,1.5-.087A1.083,1.083,0,0,0,37.91,27.614Zm-6.784,5.249V44.282c0,.763-.378,1.228-.551,1.228H24.893a.386.386,0,0,1-.386-.386v-9.53A2.512,2.512,0,0,0,22,33.083H16.26a2.512,2.512,0,0,0-2.51,2.51V45.14a.386.386,0,0,1-.386.386H7.682a.552.552,0,0,1-.551-.551V24.293L19.077,13.621,31.126,24.395v8.468Z" transform="translate(0 -11.141)" fill="#fff"/>
        </svg>
        <h4 class="align-middle">Dashboard</h4>
      </a>
    </li>
    <li class="option"  id="selected">
      <a href="/admin_page/courses/">
        <svg xmlns="http://www.w3.org/2000/svg" width="48.386" height="26.093" viewBox="0 0 48.386 26.093">
          <path id="Path_294" data-name="Path 294" d="M1.075,23.947H5.213a.925.925,0,0,1-.689-.89V.917A.921.921,0,0,1,5.441,0H42.7a.921.921,0,0,1,.917.917V23.053a.92.92,0,0,1-.689.89h4.378a1.076,1.076,0,0,1,1.075,1.075h0a1.076,1.076,0,0,1-1.075,1.075H1.075A1.076,1.076,0,0,1,0,25.018H0a1.073,1.073,0,0,1,1.075-1.071Zm10.7-19.628h9.6V15.832c-.02.323-.433.331-.882.311H11.623a1.13,1.13,0,1,0,0,2.26H20.9V17.2h.882V18.73a.5.5,0,0,1-.5.5H11.666a1.542,1.542,0,0,1-2.032-1.618V6.461a2.152,2.152,0,0,1,2.142-2.142Zm14.5,14.3a.624.624,0,0,1,0-1.244H37.806a.624.624,0,0,1,0,1.244ZM26.191,5.032H38.9a.5.5,0,0,1,.5.5V7.3a.5.5,0,0,1-.5.5H26.191a.5.5,0,0,1-.5-.5V5.528a.5.5,0,0,1,.5-.5Zm.083,6.634a.624.624,0,0,1,0-1.244H37.015a.624.624,0,0,1,0,1.244Zm0,3.477a.624.624,0,0,1,0-1.244h9.068a.624.624,0,0,1,0,1.244Zm-14.1-9.15h.358a.307.307,0,0,1,.331.268v8.414a.307.307,0,0,1-.331.268h-.358a.307.307,0,0,1-.331-.268V6.26a.3.3,0,0,1,.331-.268ZM6.091,1.437H42.177V22.793H6.091V1.437Zm17.2,22.911h3.02a.518.518,0,0,1,.516.516h0a.518.518,0,0,1-.516.516h-3.02a.518.518,0,0,1-.516-.516h0a.515.515,0,0,1,.516-.516Z" fill="#fff" fill-rule="evenodd"/>
        </svg>
        <h4 class="align-middle"> Courses</h4>
      </a>
    </li>
    <li class="option">
      <a href="/admin_page/products">
        <svg xmlns="http://www.w3.org/2000/svg" width="40.265" height="36.91" viewBox="0 0 40.265 36.91">
          <path id="products" d="M19.294,37.91,5.033,30.3V23.669l9.06,5.238,5.2-5.714Zm1.678,0V23.134l5.3,5.609,8.956-4.963V30.3ZM3.626,20.921,0,18.834l5.033-5.54L0,8.558,14.626,1,20.02,5,25.6,1,40.265,8.652,35.24,13.3l5.025,5.776L36.5,21.159v0l-9.9,5.486L20.983,20.7l12.442-6.647L20.134,6.721,6.842,14.056l12.452,6.605v.04l-5.531,6.077L5.033,21.731l-.268-.154-1.139-.659v0Z" transform="translate(0 -1)" fill="#fff" fill-rule="evenodd"/>
        </svg>
        <h4 class="align-middle">Products</h4>
      </a>
    </li>
    <li class="option">
      <a href="/admin_page/all_orders">
        <svg xmlns="http://www.w3.org/2000/svg" width="39.555" height="42.137" viewBox="0 0 39.555 42.137">
          <g id="orders" transform="translate(0 -56)">
            <path id="Path_38" data-name="Path 38" d="M8.665,29.8a1.118,1.118,0,0,1,0-2.236h7.369a1.118,1.118,0,0,1,0,2.236Zm12.285-3.24a.617.617,0,0,1,0-1.234h1.656a2.844,2.844,0,0,1,1.485.391,2.343,2.343,0,0,1,1,1.423.06.06,0,0,0,.017.048l.158.624H38.944a.612.612,0,0,1,.61.61.94.94,0,0,1-.031.189l-1.594,6.426a.6.6,0,0,1-.593.47H27.331a2.511,2.511,0,0,0,.734,1.454A4.089,4.089,0,0,0,30.1,37.2h7.08a.61.61,0,0,1,0,1.221h-7.07a4.778,4.778,0,0,1-2.736-.439,3.921,3.921,0,0,1-1.344-2.548h0L23.933,27.5c0-.017,0-.017-.014-.031a1.081,1.081,0,0,0-.47-.7,1.593,1.593,0,0,0-.861-.2H20.95Zm14.4,12.57a1.5,1.5,0,1,1-1.5,1.5,1.5,1.5,0,0,1,1.5-1.5Zm-6.583,0a1.5,1.5,0,1,1-1.5,1.5,1.5,1.5,0,0,1,1.5-1.5ZM8.665,11.514a1.118,1.118,0,0,1,0-2.236H25.987a1.118,1.118,0,1,1,0,2.236ZM2.6,0H31.956a2.587,2.587,0,0,1,2.592,2.592V23.158H32.32V2.6a.363.363,0,0,0-.367-.367H2.6a.38.38,0,0,0-.261.106.357.357,0,0,0-.1.261V36.434a.38.38,0,0,0,.106.261A.354.354,0,0,0,2.6,36.8H21.475a12.382,12.382,0,0,0,.765,2.218H2.6a2.592,2.592,0,0,1-1.834-.758A2.566,2.566,0,0,1,0,36.431V2.6A2.587,2.587,0,0,1,2.6,0ZM8.665,20.659a1.118,1.118,0,1,1,0-2.236H25.987a1.118,1.118,0,1,1,0,2.236Z" transform="translate(0 56)" fill="#fff"/>
          </g>
        </svg>
        <h4 class="align-middle">Orders</h4>
      </a>
    </li>
    <li class="option">
      <a href="/admin_page/users">
        <svg xmlns="http://www.w3.org/2000/svg" width="35.878" height="43.003" viewBox="0 0 35.878 43.003">
          <g id="user" transform="translate(0 0)">
            <path id="Path_328" data-name="Path 328" d="M97.389,20.715a10.022,10.022,0,0,0,7.324-3.034,10.022,10.022,0,0,0,3.034-7.323,10.023,10.023,0,0,0-3.035-7.323,10.355,10.355,0,0,0-14.647,0,10.022,10.022,0,0,0-3.034,7.323,10.022,10.022,0,0,0,3.035,7.324A10.024,10.024,0,0,0,97.389,20.715Zm0,0" transform="translate(-79.722)" fill="#fff"/>
            <path id="Path_329" data-name="Path 329" d="M35.791,259.611a25.582,25.582,0,0,0-.348-2.717,21.408,21.408,0,0,0-.668-2.732,13.494,13.494,0,0,0-1.123-2.548,9.615,9.615,0,0,0-1.694-2.207,7.467,7.467,0,0,0-2.433-1.529,8.408,8.408,0,0,0-3.106-.562,3.152,3.152,0,0,0-1.683.714c-.5.329-1.095.71-1.754,1.131a10.049,10.049,0,0,1-2.269,1,8.811,8.811,0,0,1-5.551,0,10.025,10.025,0,0,1-2.267-1c-.653-.417-1.243-.8-1.755-1.131a3.148,3.148,0,0,0-1.683-.714,8.4,8.4,0,0,0-3.105.563,7.461,7.461,0,0,0-2.433,1.529,9.617,9.617,0,0,0-1.693,2.207A13.521,13.521,0,0,0,1.1,254.163a21.459,21.459,0,0,0-.668,2.732,25.493,25.493,0,0,0-.348,2.718c-.057.823-.086,1.677-.086,2.539a7.141,7.141,0,0,0,2.121,5.4,7.634,7.634,0,0,0,5.465,1.993H28.292a7.633,7.633,0,0,0,5.465-1.993,7.138,7.138,0,0,0,2.121-5.4c0-.867-.03-1.721-.087-2.54Zm0,0" transform="translate(0 -226.544)" fill="#fff"/>
          </g>
        </svg>
        <h4 class="align-middle">Users</h4>
      </a>
    </li>
    <li class="option">
      <a href="/admin_page/Promo code/">
        <svg xmlns="http://www.w3.org/2000/svg" width="33.251" height="39.901" viewBox="0 0 33.251 39.901">
          <path id="iconmonstr-tag-22" d="M19.67,35.6l9.924-9.925,2.424,6.168L11.5,39.9,3.508,19.555,19.67,35.6ZM17.548,0H2V15.716L19.665,33.251,35.251,17.665ZM24.24,15.754a3.143,3.143,0,0,0-2.291-1.026,7.317,7.317,0,0,0-3.609,1.337,5.214,5.214,0,0,1-2.421.971,1.761,1.761,0,0,1-1.6-2.025,3.139,3.139,0,0,1,.951-1.7,2.5,2.5,0,0,1,3.784-.176L20.293,11.9a4.2,4.2,0,0,0-2.928-1.317A4.3,4.3,0,0,0,14.6,11.711L13.56,10.669,12.4,11.831l1.086,1.084c-.946,1.373-1.4,3.36.126,4.885,1.681,1.681,3.638.9,5.674-.386a4.906,4.906,0,0,1,2.452-.936,1.807,1.807,0,0,1,1.792,2.091A3.287,3.287,0,0,1,22.5,20.434a3.252,3.252,0,0,1-2.239,1.129,2.569,2.569,0,0,1-1.744-.768l-1.229,1.229a4.153,4.153,0,0,0,2.885,1.252,4.439,4.439,0,0,0,2.68-.993l.9.894,1.159-1.159-.865-.866c1.235-1.49,1.924-3.673.2-5.4ZM8.15,3.325A2.825,2.825,0,1,1,5.325,6.15,2.825,2.825,0,0,1,8.15,3.325Z" transform="translate(-2)" fill="#fff" fill-rule="evenodd"/>
        </svg>
        <h4 class="align-middle">Codes</h4>
      </a>
    </li>
  </ul>
  <div class="signout">
    <a href="{{ url_for("signout") }}">
      <svg xmlns="http://www.w3.org/2000/svg" width="29.47" height="31.793" viewBox="0 0 29.47 31.793">
        <g id="Group_15996" data-name="Group 15996" transform="translate(29.47 31.793) rotate(180)">
          <path id="Path_40" data-name="Path 40" d="M31.415,29.971H23.123a4.088,4.088,0,0,1-4.082-4.082V5.9a4.088,4.088,0,0,1,4.082-4.082H31.55A.911.911,0,1,0,31.55,0H23.123a5.91,5.91,0,0,0-5.9,5.9V25.889a5.91,5.91,0,0,0,5.9,5.9h8.292a.911.911,0,1,0,0-1.822Z" transform="translate(-17.219)" fill="#fff"/>
          <path id="Path_41" data-name="Path 41" d="M142.751,142.382l-5.789-5.789a.911.911,0,0,0-1.289,1.289l4.237,4.237H121.43a.911.911,0,0,0,0,1.822h18.481l-4.237,4.237a.914.914,0,0,0,.641,1.559.889.889,0,0,0,.641-.27l5.789-5.789A.91.91,0,0,0,142.751,142.382Z" transform="translate(-113.549 -127.127)" fill="#fff"/>
        </g>
      </svg>
      <p id="signout" class="align-middle">Sign Out</p>
    </a>
  </div>
</div>

<div class="popup">
  <div class="popuptext" id="uploading">
    <h3 style="text-align:center;padding-top:10px;font-family: 'STIXGeneral', serif;font-weight: bold; margin-left:10px;">Uploading</h3>
    <div class="loader"></div>
  </div>
</div>
<div class="new_course" id="new_course">
  <form action="{{ url_for('create_new_course') }}" method="post" enctype="multipart/form-data" id="create_course_form">
    <input type="text" name="course_image_input" value="" id="course_image_input" style="display:none;">
    <input type="text" name="course_video_input" value="" id="course_video_input" style="display:none;">
    <input type="text" name="courseID_input" value="" id="courseID_input" style="display:none;">
    <input name='course_duration' id="course_duration" type="text" style="display:none;">
  <ul>
    <li style="height:40px;"><h2>New Course</h2></li>
    <li style="height:50px;margin-top:20px;"><p>Course Name</p><textarea id="course_name" name='course_name' type="text" placeholder=""></textarea></li>
    <li style="height:50px;margin-top:20px;"><p>Course Price</p><textarea id='course_price' name='course_price' type="text" placeholder=""></textarea></li>

    <li style="height:100px;"><p>Course Short Description</p><textarea id='course_short_desc' name='course_short_desc' style="height:80px;" type="text" placeholder=""></textarea></li>
    <li style="height:180px;"><p>Course Description</p><textarea id='course_desc' name='course_desc' style="height:160px;" type="text" placeholder=""></textarea></li>
    <li style="height:100px;"><p>Learning Outcome</p><textarea id='learning_outcome' name='learning_outcome' style="height:80px;" type="text" placeholder=""></textarea></li>
    <li style="height:50px;">
      <p>Course Level</p>

      <label for="All Levels" style="margin-right:10px;"><input id="radio1" type="radio" name="course_level" value="All Levels">All Levels</label>
      <label for="Beginner" style="margin-right:10px;"><input id="radio2"  type="radio" name="course_level" value="Beginner">Beginner</label>
      <label for="Intermediate" style="margin-right:10px;"><input id="radio3" type="radio" name="course_level" value="Intermediate">Intermediate</label>
      <label for="Professionals" style="margin-right:10px;"><input id="radio4" type="radio" name="course_level" value="Professionals">Professionals</label>
    </li>
    <li style="height:50px;">
      <p>Course Tag</p>
      <input id="tag_input" type="text" placeholder="">
      <input id="tag_list" name="tag" type="text" style="display:none;">
      <button id="enter_tag_button" type="button" name="button" onclick=enter_tag()>Add</button>
      <div style="display:inline-block;width:calc(100% - 200px);margin-left:200px;overflow: auto;white-space: nowrap;" id="tag_div">
      </div>
      <script type="text/javascript">
        var tag_input = document.getElementById("tag_input");
        tag_input.addEventListener("keyup", function(event) {
          if (event.keyCode == 13) {
            event.preventDefault();
            if (tag_input.value.length > 0) {
              document.getElementById("enter_tag_button").click();
            }
          }
        });
        function enter_tag() {
          if (tag_input.value.length > 0) {
              var div = document.getElementById('tag_div');
              const list = document.createElement("LI");
              list.className = "tag_li"
              var colors = ['#FBF8F1', '#FDEBF7', '#EFDAD7', '#C0D8C0', '#FFE162', '#D9D7F1', '#E7FBBE', '#F5F5F5', '#FDF5CA'];
              list.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
              const list_text = document.createTextNode(tag_input.value);
              const remove_tag_btn = document.createElement('button');
              remove_tag_btn.style.border = "none";
              remove_tag_btn.style["background-color"] = "transparent";
              remove_tag_btn.innerHTML = '<img src="../../../../static/images/remove_button.png" style="width:10px;height:10px;" />';
              remove_tag_btn.onclick =  function(){
                list.parentNode.removeChild(list);
              };
              list.appendChild(list_text);
              list.appendChild(remove_tag_btn);
              div.appendChild(list);

          }

        }
        document.addEventListener('keypress', function (e) {
            if (e.keyCode === 13 || e.which === 13) {
                e.preventDefault();
                return false;
            }

        });
      </script>
    </li>
    <li style="height:50px;"><p>Video</p>
      <input id="video_input" name='video' type="file" placeholder="" accept="video/mp4,video/x-m4v,video/*" onchange="loadVideo(event)">
    </li>
    <br>
    <video id="course_vid" width="320" height="240" controls>
    </video>
    <script type="text/javascript">
        var loadVideo = function(event) {
          var source = document.createElement('source');
          var video = document.getElementById('course_vid');

          source.setAttribute('src', URL.createObjectURL(event.target.files[0]));
          source.setAttribute('type', 'video/mp4');
          video.appendChild(source);
        };

    </script>


    <li style="height:50px;margin-top:30px;"><p>Course Image</p><input accept="image/*" onchange="loadFile(event)" id="course_image" name='course_image' type="file" placeholder=""></li>
    <br><img id="course_img" style="height:240px;" src="#">
    <script type="text/javascript">

        var loadFile = function(event) {
	         var image = document.getElementById('course_img');
	          image.src = URL.createObjectURL(event.target.files[0]);
          };

    </script>
    <li>
      <a onclick="cancel()">
        <div class="cancel-btn">
        Cancel
        </div>
      </a>
    </li>
    <li style="height:50px;"><a onclick="create()" class="new-course-btn" id="create_btn">Create</a></li>

      <script type="text/javascript">
        function cancel() {
          window.history.back();
        }
        function create() {
          var tag_lists = document.getElementsByClassName('tag_li');
          var tags = "";
          for (var i = 0; i < tag_lists.length; i++) {
            if (tags.length == 0) {
              tags=tag_lists[i].innerText;
            } else {
              tags = tags + "," +tag_lists[i].innerText;
            }

          }



          if (isFormValid()) {
            var video = document.getElementById('course_vid');
            document.getElementById('course_duration').value = video.duration/60;
            document.getElementById("tag_list").value = tags;
            var popup = document.getElementById("uploading");
            popup.classList.toggle("show");
            document.getElementById("new_course").classList.add('loading');

            var course_name = document.getElementById('course_name').value;
            var courseID = 'CR'+course_name.split(' ')[0].charAt(0) + course_name.split(' ')[0].charAt(1) + String(Math.floor(Math.random() * 1000));
            document.getElementById('courseID_input').value = courseID;

            const storageRef = firebase.storage().ref();

            storageRef.child('/courses/image_of_'+courseID).put(document.getElementById('course_image').files[0]).then((snapshot) => {

              storageRef.child('/courses/image_of_'+courseID).getDownloadURL()
              .then((url) => {
                  document.getElementById('course_image_input').value = url;

                  storageRef.child('/courses/video_of'+courseID).put(document.getElementById('video_input').files[0]).then((snapshot) => {

                    storageRef.child('/courses/video_of'+courseID).getDownloadURL()
                    .then((url) => {
                        document.getElementById('course_video_input').value = url;
                        // document.getElementById("new_course").classList.remove('loading');
                        // var popup = document.getElementById("myPopup");
                        // popup.classList.toggle("show");

                        document.getElementById("create_course_form").submit();
                    })
                    .catch((error) => {
                        alert(error);
                    });
                  }).catch((error) => {
                      alert(error);
                  });



              })
              .catch((error) => {
                  alert(error);
              });
            })
          }
        }



        function isFormValid() {
          var course_name = document.getElementById('course_name').value;
          var course_price = document.getElementById('course_price').value;
          var course_short_desc = document.getElementById('course_short_desc').value;
          var course_desc = document.getElementById('course_desc').value;
          var learning_outcome = document.getElementById('learning_outcome').value;

          var radio1_checked = document.getElementById('radio1').checked;
          var radio2_checked = document.getElementById('radio2').checked;
          var radio3_checked = document.getElementById('radio3').checked;
          var radio4_checked = document.getElementById('radio4').checked;
          var image_file = document.getElementById('course_image').files[0];
          var video_file = document.getElementById('video_input').files[0];

          if (course_name.length<5) {
            alert("Course name must be greater than 5 characters.");
            return false;
          } else if (!((/[\.]/.test(course_price))||(/^-?[0-9]+$/.test(course_price)))) {
            alert("Price of the course must be a number.");
            return false;
          } else if(course_name.length==0||course_price.length==0||course_short_desc.length==0||course_desc.length==0||learning_outcome.length==0){
            alert("Fields cannot be empty.");
            return false;
          } else if (!(radio1_checked||radio2_checked||radio3_checked||radio4_checked)) {
            alert("Course level is not chosen.");
            return false;
          } else if (image_file==null) {
            alert("Image is not uploaded.");
            return false;
          } else if (video_file==null) {
            alert("Video is not uploaded.");
            return false;
          } else {
            return true;
          }

        }
      </script>
  </ul>
</form>
</div>
{% endblock %}

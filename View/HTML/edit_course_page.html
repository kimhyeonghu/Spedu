{% extends 'admin_page.html' %}
{% block head %}
<title>Edit Selected Course</title>
<link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/edit_course_page.css') }}">

{% endblock %}
{% block body %}



<div class="current_course_div">
  <form action="{{ url_for('update_course') }}" method="post" enctype="multipart/form-data" id="update_course_form">
    <input type="text" name="courseID" value="{{selected_course.courseID}}" style="display:none;">
    <input type="text" name="course_image_input" value="" id="course_image_input" style="display:none;">
  <ul>
    <li style="height:40px;"><h2>Update Course</h2></li>
    <li style="height:50px;margin-top:20px;"><p>Course Name</p>{{selected_course.name}}</li>
    <li style="height:50px;margin-top:20px;"><p>Course Price</p><textarea name='course_price' type="text" placeholder="">{{selected_course.price}}</textarea></li>
    <li style="height:50px;"><p>Course Trainer</p><textarea name='course_trainer' type="text" placeholder="">{{selected_course.trainer}}</textarea></li>
    <li style="height:100px;"><p>Course Short Description</p><textarea name='course_short_desc' style="height:80px;" type="text" placeholder="">{{selected_course.short_description}}</textarea></li>
    <li style="height:180px;"><p>Course Description</p><textarea name='course_desc' style="height:160px;" type="text" placeholder="">{{selected_course.description}}</textarea></li>
    <li style="height:100px;"><p>Learning Outcome</p><textarea name='learning_outcome' style="height:80px;" type="text" placeholder="">{{selected_course.learning_outcome}}</textarea></li>

    <li style="height:50px;">
      <p>Course Level</p>
      <label for="All Levels" style="margin-right:10px;"><input id="all_level" type="radio" name="course_level" value="All Levels">All Levels</label>
      <label for="Beginner" style="margin-right:10px;"><input id="beginner"  type="radio" name="course_level" value="Beginner">Beginner</label>
      <label for="Intermediate" style="margin-right:10px;"><input id="intermediate" type="radio" name="course_level" value="Intermediate">Intermediate</label>
      <label for="Professionals" style="margin-right:10px;"><input id="professionals" type="radio" name="course_level" value="Professionals">Professionals</label>
    </li>
    <script type="text/javascript">
      const level = '{{selected_course.level}}';
      var level_input_id = '';
      if (level == "All Levels") {
        level_input_id = 'all_level';
      } else if (level == "Beginner") {
        level_input_id = 'beginner';
      } else if (level == "Intermediate") {
        level_input_id = 'intermediate';
      } else if (level == "Professionals") {
        level_input_id = 'professionals';
      }
      const radioBtn = document.getElementById(level_input_id);
      radioBtn.checked = true;
    </script>
    <li style="height:50px;"><p>Video Link</p><textarea name='video_link' type="text" placeholder="">{{selected_course.video_link}}</textarea></li>
    <li style="height:50px;"><p>Course Duration</p><textarea name='course_duration' type="text" placeholder="">{{selected_course.duration}}</textarea></li>
    <li style="height:50px;">
      <p>Course Tag</p>
      <input id="tag_input" type="text" placeholder="">
      <input id="tag_list" name="tag" type="text" style="display:none;">
      <button id="enter_tag_button" type="button" name="button" onclick=enter_tag()>Add</button>
      <div style="display:inline-block;width:calc(100% - 200px);margin-left:200px;overflow: auto;white-space: nowrap;" id="tag_div">
      </div>
      <script type="text/javascript">
        var tag_input = document.getElementById("tag_input");
        tag_input.addEventListener("keyup", function(event) {
          if (event.keyCode == 13) {
            event.preventDefault();
            if (tag_input.value.length > 0) {
              document.getElementById("enter_tag_button").click();
            }
          }
        });
        var course_tag = {{selected_course_tag|safe}};
        for (var i = 0; i < course_tag.length; i++) {
          var tag = course_tag[i];
          var div = document.getElementById('tag_div');
          const list = document.createElement("LI");
          list.className = "tag_li"
          var colors = ['#FBF8F1', '#FDEBF7', '#EFDAD7', '#C0D8C0', '#FFE162', '#D9D7F1', '#E7FBBE', '#F5F5F5', '#FDF5CA'];
          list.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
          const list_text = document.createTextNode(tag);
          const remove_tag_btn = document.createElement('button');
          remove_tag_btn.style.border = "none";
          remove_tag_btn.style["background-color"] = "transparent";
          remove_tag_btn.innerHTML = '<img src="../../../../static/images/remove_button.png" style="width:10px;height:10px;" />';
          remove_tag_btn.onclick =  function(){
            list.parentNode.removeChild(list);
          };
          list.appendChild(list_text);
          list.appendChild(remove_tag_btn);
          div.appendChild(list);
        }
        function enter_tag() {
          if (tag_input.value.length > 0) {
              var div = document.getElementById('tag_div');
              const list = document.createElement("LI");
              list.className = "tag_li"
              var colors = ['#FBF8F1', '#FDEBF7', '#EFDAD7', '#C0D8C0', '#FFE162', '#D9D7F1', '#E7FBBE', '#F5F5F5', '#FDF5CA'];
              list.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
              const list_text = document.createTextNode(tag_input.value);
              const remove_tag_btn = document.createElement('button');
              remove_tag_btn.style.border = "none";
              remove_tag_btn.style["background-color"] = "transparent";
              remove_tag_btn.innerHTML = '<img src="../../../../static/images/remove_button.png" style="width:10px;height:10px;" />';
              remove_tag_btn.onclick =  function(){
                list.parentNode.removeChild(list);
              };
              list.appendChild(list_text);
              list.appendChild(remove_tag_btn);
              div.appendChild(list);

          }

        }
        document.addEventListener('keypress', function (e) {
            if (e.keyCode === 13 || e.which === 13) {
                e.preventDefault();
                return false;
            }

        });
      </script>
    </li>
    <li style="height:50px;margin-top:30px;"><p>Course Image</p><input name='course_image' type="file" placeholder="" value="" onclick="update_img()"></li>

    <br><img id="course_img" src="#">
    <script type="text/javascript">
    function update_img() {
        document.querySelector('input[type="file"]').addEventListener('change', function() {
          if (this.files && this.files[0]) {
            document.getElementById("course_img").src = URL.createObjectURL(this.files[0]);
          }
          });
      };
      function load_image() {
        var courseID = '{{selected_course.courseID}}';
        storage.ref().child('courses/image_of_'+courseID).getDownloadURL().then(function(url) {
            document.getElementById('course_img').src = url;
            document.getElementById('course_image_input').value = url;
        })
      }

      window.onload = load_image;
    </script>
    <li>
      <ul>
        <li>
          <button type="button" onclick="update()" class="update-course-btn">Update</button>
        </li>
        <li>
          <a onclick="cancel()">
            <div class="cancel-btn">
            Cancel
            </div>
          </a>
        </li>
      </ul>
    </li>


    <script type="text/javascript">
      function update() {
        var tag_lists = document.getElementsByClassName('tag_li');
        var tags = "";
        for (var i = 0; i < tag_lists.length; i++) {
          if (tags.length == 0) {
            tags=tag_lists[i].innerText;
          } else {
            tags = tags + "," +tag_lists[i].innerText;
          }
        }
        document.getElementById("tag_list").value = tags;
        document.getElementById("update_course_form").submit();
      }
      function cancel() {
        window.history.back();
      }
    </script>

  </ul>
</form>
</div>
{% endblock %}
